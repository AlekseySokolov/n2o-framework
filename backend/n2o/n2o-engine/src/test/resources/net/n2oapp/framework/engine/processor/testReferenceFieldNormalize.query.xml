<?xml version='1.0' encoding='UTF-8'?>
<query xmlns="http://n2oapp.net/framework/config/schema/query-5.0">
    <list>
        <test file="net/n2oapp/framework/engine/processor/testReferenceFields.json"/>
    </list>

    <fields>
        <field id="myId" mapping="['id']" normalize="#this + #data[myCode]"/>
        <field id="myCode" mapping="['code']" normalize="#this + 100"/>
        <field id="myName" mapping="['name']" normalize="#this.toUpperCase()"/>
        <reference id="myOrganization" mapping="['organization']"
                   normalize="T(java.util.Map).of('code', 100, 'title', 'refNormalize')">
            <field id="myCode" mapping="['code']" normalize="#this + #data[myTitle]"/>
            <field id="myTitle" mapping="['title']" normalize="#this + ' fieldNormalize'"/>
            <list id="myEmployees" mapping="['employees']">
                <field id="myId" mapping="['id']"/>
                <field id="myName" mapping="['name']"/>
            </list>
        </reference>
        <list id="myDepartments" mapping="['departments']">
            <field id="myId" mapping="['id']"/>
            <field id="myName" mapping="['name']"/>
            <list id="myGroups" mapping="['groups']">
                <field id="myId" mapping="['id']"/>
                <field id="myName" mapping="['name']"/>
            </list>
            <reference id="myManager" mapping="['manager']">
                <field id="myId" mapping="['id']"/>
                <field id="myName" mapping="['name']"/>
            </reference>
        </list>
    </fields>
</query>
