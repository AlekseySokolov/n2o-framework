---
title: Выборка
description: ""
---

Тип метаданных `query`

**Библиотека компонентов**

```
http://n2oapp.net/framework/config/schema/query-5.0
```
**Атрибуты**

|Наименование|Тип                                |Описание            |Значение по умолчанию|
|------------|-----------------------------------|--------------------|---------------------|
|object-id   |Ссылка на [объект](../xml/object)  |Объект выборки      |                     |
|route       |Строка                             |URL выборки         |Идентификатор выборки|

**Тело**

[Получение списка записей по определенным фильтрам](../xml/query#list),
[Получение количества записей](../xml/query#count),
[Получение уникальной записи по определенным фильтрам](../xml/query#unique),
[Список полей выборки](../xml/query#fields),
[Способы фильтрации полей выборки](../xml/query#filters)

**Пример**

```xml
<?xml version='1.0' encoding='UTF-8'?>
<query xmlns="http://n2oapp.net/framework/config/schema/query-5.0"
  object-id="myObject">
  <list>
    <sql>SELECT :select FROM mytable WHERE :filters ORDER BY :sorting LIMIT :limit OFFSET :offset</sql>
  </list>
  <count>
    <sql>SELECT count(*) FROM mytable WHERE :filters</sql>
  </count>

  <fields>
    ...
  </fields>
</query>
```

## &lt;list&gt; {#list}

Получение списка записей по определенным фильтрам.

:::note

В выборке может быть несколько *&lt;list&gt;* с разными наборами фильтров (атрибут *filters*).

:::

**Атрибуты**

|Наименование    |Тип                              |Описание                                                                                                      |Значение по умолчанию                                   |
|----------------|---------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|filters         |Идентификаторы через запятую     |Идентификаторы фильтров (`filter-id`). При наличии хотя бы одного из фильтров сработает этот провайдер данных.|                                                        |
|count-mapping   |Строка                           |Маппинг общего количества записей                                                                             |Для каждого провайдера данных свои значения по умолчанию|
|result-mapping  |Строка                           |Маппинг списка результатов                                                                                    |Для каждого провайдера данных свои значения по умолчанию|
|result-normalize|Строка                           |Нормализация списка результатов                                                                               |                                                        |

**Тело**

[Провайдер данных](../xml/dataprovider)

**Пример**

```xml
<list filters="firstNameLike, lastNameLike">
  <sql>SELECT first_name, last_name
       FROM mytable
       WHERE first_name like '%'||:first_name
          OR last_name '%'||:last_name
  </sql>
</list>

<filters>
  <like filter-id="firstNameLike" field-id="firstName" mapping="first_name"/>
  <like filter-id="lastNameLike" field-id="lastName" mapping="last_name"/>
</filters>

<fields>
  <field id="firstName"/>
  <field id="lastName"/>
</fields>
```

## &lt;count&gt; {#count}

Получение количества записей.

:::note

В выборке может быть несколько *&lt;count&gt;* с разными наборами фильтров (атрибут *filters*).

:::

**Атрибуты**


|Наименование |Тип                              |Описание                                                                                                      |Значение по умолчанию                                   |
|-------------|---------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|count-mapping|Строка                           |Маппинг общего количества записей                                                                             |Для каждого провайдера данных свои значения по умолчанию|
|filters      |Идентификаторы через запятую     |Идентификаторы фильтров (`filter-id`). При наличии хотя бы одного из фильтров сработает этот провайдер данных.|                                                        |

**Тело**

[Провайдер данных](../xml/dataprovider)

**Пример**

```xml
<count filters="firstNameLike">
  <sql>SELECT count(*) FROM mytable</sql>
</count>
```

## &lt;unique&gt; {#unique}

Получение уникальной записи по определенным фильтрам.

:::note

В выборке может быть несколько *&lt;unique&gt;* с разными наборами фильтров (атрибут *filters*).

:::

**Атрибуты**

|Наименование    |Тип                              |Описание                                                                                                      |Значение по умолчанию                                   |
|----------------|---------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|filters         |Идентификаторы через запятую     |Идентификаторы фильтров (`filter-id`). При наличии хотя бы одного из фильтров сработает этот провайдер данных.|                                                        |
|result-mapping  |Строка                           |Маппинг результата                                                                                            |Для каждого провайдера данных свои значения по умолчанию|
|result-normalize|Строка                           |Нормализация результата                                                                                       |                                                        |

**Тело**

[Провайдер данных](../xml/dataprovider)

**Пример**

```xml
<unique filters="id">
  <sql>SELECT first_name, last_name
       FROM mytable
       WHERE id = :id
  </sql>
<unique>

<filters>
  <eq filter-id="id" field-id="id"/>
</filters>

<fields>
  <field id="id"/>
</fields>
```

## &lt;fields&gt; {#fields}

Поля выборки

**Тело**

[Простое поле](../xml/query#field),
[Составное поле](../xml/query#reference),
[Списковое поле](../xml/query#list-field)

### &lt;field&gt; {#field}

Простое поле выборки

**Атрибуты**

|Наименование       |Тип                                        |Описание                                                             |Значение по умолчанию                         |
|-------------------|-------------------------------------------|---------------------------------------------------------------------|----------------------------------------------|
|id                 |Строка                                     |Идентификатор поля                                                   |                                              |
|name               |Строка                                     |Наименование поля                                                    |Наименование аналогичного поля в объекте      |
|domain             |[Тип данных](../xml/base#Data_types_domain)|Тип данных                                                           |string                                        |
|default-value      |Строка                                     |Значение, которое проставится в поле, если в провайдере оно пустое   |                                              |
|sorting            |true false                                 |Является ли поле сортируемым                                         |false. Если задан sorting-expression, то true |
|sorting-mapping    |Строка                                     |Маппинг плейсхолдера направления сортировки в провайдере             |По умолчанию [fieldId]Direction               |
|sorting-expression |Строка                                     |Выражение, определяющее как сортировать это поле выборки в провайдере|                                              |
|mapping            |Строка                                     |Маппинг данных поля из провайдера                                    |Cовпадает с id                                |
|normalize          |Строка                                     |Нормализация данных поля из провайдера                               |                                              |
|select             |true false                                 |Участвует ли поле в выборке                                          |true                                          |
|select-expression  |Строка                                     |Выражение для подстановки на место плейсхолдера select в провайдере  |                                              |

**Пример**

```xml
<field id="myName" mapping="['name']" default-value="user" normalize="#this.toUpperCase()"/>
```

### &lt;reference&gt; {#reference}

Составное поле выборки

**Атрибуты**

|Наименование       |Тип                                        |Описание                                                             |Значение по умолчанию                   |
|-------------------|-------------------------------------------|---------------------------------------------------------------------|----------------------------------------|
|id                 |Строка                                     |Идентификатор поля                                                   |                                        |
|mapping            |Строка                                     |Маппинг данных поля из провайдера                                    |Cовпадает с id                          |
|normalize          |Строка                                     |Нормализация данных поля из провайдера                               |                                        |
|select             |true false                                 |Участвует ли поле в выборке                                          |true                                    |
|select-expression  |Строка                                     |Выражение для подстановки на место плейсхолдера select в провайдере  |                                        |
|select-key         |Строка                                     |Ключ для резолва плейсхолдера в select-expression                    |                                        |

**Тело**

[Простое поле](../xml/query#field),
[Составное поле](../xml/query#reference),
[Списковое поле](../xml/query#list-field)

**Пример**

```xml
<reference id="owner" select-expression="owner { $$ownerSelect }" select-key="ownerSelect">
    <field>...</field>
    <list>...</list>
    <reference>...</reference>
</reference>
```

### &lt;list&gt; {#list-field}

Списковое поле выборки

**Атрибуты**

|Наименование       |Тип                                        |Описание                                                             |Значение по умолчанию                   |
|-------------------|-------------------------------------------|---------------------------------------------------------------------|----------------------------------------|
|id                 |Строка                                     |Идентификатор поля                                                   |                                        |
|mapping            |Строка                                     |Маппинг данных поля из провайдера                                    |Cовпадает с id                          |
|normalize          |Строка                                     |Нормализация данных поля из провайдера                               |                                        |
|select             |true false                                 |Участвует ли поле в выборке                                          |true                                    |
|select-expression  |Строка                                     |Выражение для подстановки на место плейсхолдера select в провайдере  |                                        |
|select-key         |Строка                                     |Ключ для резолва плейсхолдера в select-expression                    |                                        |

**Тело**

[Простое поле](../xml/query#field),
[Составное поле](../xml/query#reference),
[Списковое поле](../xml/query#list-field)

**Пример**

```xml
<list id="showrooms" select-key="showroomsSelect" select-expression="showrooms { $$showroomsSelect }">
    <field>...</field>
    <list>...</list>
    <reference>...</reference>
</list>
```

## &lt;filters&gt; {#filters}

Способы фильтрации полей выборки.

**Тело**

|Наименование      |Тип      |Описание                                |Значение по умолчанию|
|------------------|---------|----------------------------------------|---------------------|
|&lt;eq&gt;        |Выражение|Фильтр эквивалентности                  |                     |
|&lt;in&gt;        |Выражение|Фильтр вхождения хотя бы одного в список|                     |
|&lt;like&gt;      |Выражение|Фильтр вхождения подстроки в строку     |                     |
|&lt;likeStart&gt; |Выражение|Фильтр начала подстроки                 |                     |
|&lt;isNull&gt;    |Выражение|Фильтр пустого поля                     |                     |
|&lt;contains&gt;  |Выражение|Фильтр вхождения списка в список        |                     |
|&lt;overlaps&gt;  |Выражение|Фильтр пересечения списка со списком    |                     |
|&lt;more&gt;      |Выражение|Фильтр больше                           |                     |
|&lt;less&gt;      |Выражение|Фильтр меньше                           |                     |
|&lt;notEq&gt;     |Выражение|Фильтр не эквивалентности               |                     |
|&lt;notIn&gt;     |Выражение|Фильтр не вхождения в список            |                     |
|&lt;isNotNull&gt; |Выражение|Фильтр не пустого поля                  |                     |

**Базовые атрибуты**

|Наименование |Тип                                        |Описание                                                                                                  |Значение по умолчанию                                                                |
|-------------|-------------------------------------------|----------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
|filter-id    |Строка                                     |Идентификатор фильтра                                                                                     |                                                                                     |
|field-id     |Строка                                     |Идентификатор [поля](../xml/query#field) фильтра                                                          |                                                                                     |
|mapping      |Выражение                                  |Маппинг значения фильтра в параметры провайдера                                                           |Эквивалентен `id`                                                                    |
|domain       |[Тип данных](../xml/base#Data_types_domain)|Тип, в который будет конвертировано значение при отправке в провайдер                                     |Эквивалентен `domain` от `<field>` с преобразованием в список для множественных типов|
|default-value|Строка                                     |Значение, по которому будет идти постоянная фильтрация, если для этого фильтра не передано другое значение|                                                                                     |
|normalize    |Строка                                     |Выражение для предварительного преобразования входных данных.                                             |                                                                                     |

**Пример**

```xml
<filters>
  <eq field-id="gender.id" mapping="gender_id"
    default-value="1">gender_id = :gender_id</eq>
  <in field-id="genders" filter-id="genders*.id"
    domain="integer[]">gender_id in (:genders)</in>
  <like field-id="gender.name" filter-id="gender.name" domain="string" normalize="#this.toLowerCase()"/>
</filters>
```
